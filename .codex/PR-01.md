# PR-01 — Add E2E harness skeleton (TestEnv) + artifacts-on-failure

## Goal
Create a stable foundation for complex end-to-end tests in greentic-integration by introducing a `TestEnv` harness that:
- boots dependencies/services for tests
- exposes URLs/ports to tests
- captures logs/artifacts on failure automatically

## Non-goals
- No real provider integrations yet (Slack/Teams/etc).
- No multi-tenant scenarios yet (later PRs).

## Scope
Add a small Rust library module + minimal integration test that uses it.

## Implementation Plan
1) Create `src/harness/mod.rs` with:
   - `pub struct TestEnv { ... }`
   - `impl TestEnv { pub async fn up() -> Result<Self> }`
   - `pub async fn down(self) -> Result<()>` (idempotent)
   - `pub fn artifacts_dir(&self) -> &Path`
   - `pub fn logs_dir(&self) -> &Path`
   - `pub async fn healthcheck(&self) -> Result<()>`
2) Add a convention:
   - All tests write into `target/e2e/<test-name>/`
   - On failure, dump:
     - docker/compose logs (if used)
     - greentic service logs (if available)
     - resolved config snapshot(s)
3) Add `E2E_TEST_NAME` support:
   - harness reads test name from env or caller passes it
4) Add a first test `tests/e2e_smoke.rs`:
   - `let env = TestEnv::up().await?; env.healthcheck().await?;`
   - Assert harness created directories and wrote a marker file.

## Preferred Approach
Use one of these boot strategies (pick the one already used in repo; if none exists, default to Docker Compose):
- Docker Compose in `tests/compose/compose.e2e.yml`
- or `testcontainers-rs`

Keep it minimal; PR-02 will add services.

## Files to Add / Modify
- `src/harness/mod.rs`
- `src/lib.rs` (export harness)
- `tests/e2e_smoke.rs`
- `README.md` (short “how to run e2e”)
- `.gitignore` (ignore `target/e2e/` if needed)

## Acceptance Criteria
- `cargo test -p greentic-integration e2e_smoke` passes locally.
- Harness creates `target/e2e/<test-name>/logs` and `.../artifacts`.
- On test failure (simulate by `assert!(false)`), harness still preserves logs/artifacts.

## Routine actions pre-authorized
- Add new modules, small refactors, helper crates, and dev scripts.
- Add minimal README instructions.
