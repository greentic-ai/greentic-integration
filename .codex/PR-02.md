PR-02.md — Add Docker Compose (or Testcontainers) Boot for Core Dependencies
Copy code
Md
# PR-02 — Boot core dependencies for E2E (NATS + DB) + health checks

## Goal
Enable real end-to-end tests with real infra primitives:
- NATS for routing
- Postgres (or SQLite if platform uses it) for persistence components that require DB

## Scope
Add Compose/testcontainers setup and wire into TestEnv.

## Implementation Plan
1) Add compose config `tests/compose/compose.e2e.yml` including:
   - `nats: latest stable` (with ports exposed for tests)
   - `postgres` (optional; only if needed for downstream repos)
2) Update `TestEnv::up()` to:
   - start compose
   - wait for NATS ready (TCP connect + optional ping)
   - wait for DB ready (connect + simple query)
3) Add `TestEnv` getters:
   - `pub fn nats_url(&self) -> String`
   - `pub fn db_url(&self) -> String` (if applicable)
4) Add a test `tests/e2e_infra.rs`:
   - connect to NATS
   - publish + subscribe round-trip
   - connect to DB and run a trivial query (if DB used)

## Files
- `tests/compose/compose.e2e.yml`
- `src/harness/mod.rs` (start/stop)
- `tests/e2e_infra.rs`

## Acceptance Criteria
- Infra test passes in CI and locally.
- Compose is torn down on success and preserved logs on failure.
