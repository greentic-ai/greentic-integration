# PR-14 â€” Greentic-dev E2E: negative & validation scenarios

## Goal
Extend the greentic-dev integration tests with **failure-path coverage**, proving that:
- invalid components
- invalid flows
- invalid step insertion
- missing dependencies

are detected early with clear errors.

## Scope
- Build on the PR-13 E2E harness and helpers.
- Focus on **validation correctness**, not new features.
- Tests must be deterministic and CI-safe.

## Test cases to add

### 1) Invalid component build
- Scaffold a component via `greentic-dev component new`.
- Intentionally break the implementation (e.g. missing required export or compile error).
- Run `greentic-dev component build`.
- Assert:
  - command fails
  - stderr contains a clear diagnostic (no panic / backtrace dump).

### 2) Flow references missing component
- Generate a pack.
- Create a flow referencing a non-installed component.
- Run `greentic-dev pack validate`.
- Assert validation fails with:
  - missing component name
  - suggested remediation (install/register component).

### 3) Invalid add-step insertion
- Create a valid multi-step flow.
- Attempt:
  - `add-step` with a non-existent step ID
  - or insertion into an incompatible flow type.
- Assert:
  - CLI exits non-zero
  - error message clearly identifies invalid insertion point.

### 4) Pack build fails on invalid flow
- Keep component valid but flow invalid.
- Run `greentic-dev pack build`.
- Assert:
  - build fails before producing `.gtpack`
  - validation error is surfaced, not swallowed.

## Structure
- Add new test module:
  - `tests/e2e_greentic_dev_negative.rs`
- Reuse helpers from PR-13 (CLI runner, temp workspace).

## Acceptance criteria
- Each failure case:
  - fails fast
  - returns a meaningful error message
  - does not leave partial artifacts behind
